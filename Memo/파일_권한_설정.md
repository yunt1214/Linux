# 파일 권한 설정 (허가권과 소유권)

## 파일 접근 권한

- 리눅스는 하나의 시스템에 다수 사용자가 동시에 접속해서 사용하는 운영체제
- 여러 사용자가 동일한 저장 공간을 사용하는 구조
- 각각의 사용자들이 생성한 파일이나 디렉토리가 다른 사용자들에게 노출
- 소유권과 허가권이라는 두 권한을 가지고 접근 제어를 함

### 파일의 종류

- \- : 일반파일
- d : 디렉토리
- l : 심볼릭링크 파일 (바로 가기와 비슷)
- b : 블록 디바이스 (디스크 드라이브 파일)
- c : 캐릭터 디바이스 (입출력 관련 특수 파일)
- s : 소켓

## 소유권

- 어떤 파일이나 디렉토리를 소유하는 권리
- 소유자(u), 소유그룹(g), 그 외 사용자(o)로 나뉨 (a : 모두)

### 소유권 변경

- 파일이나 디렉토리의 소유권을 변경
- 'root'만 변경 가능
- R 옵션 사용 가능 : 디렉토리 지정 시 안의 파일 및 디렉토리도 같이 변경

######

    # chown [소유자] [파일 or 디렉토리] // 소유자 변경

    # chgrp [소유 그룹] [파일 or 디렉토리] // 소유 그룹 변경

    # chown [소유자].[소유 그룹] [파일 or 디렉토리] // 소유자 및 소유 그룹 변경

## 허가권

- 해당 파일이나 디렉토리에 읽고, 쓰고, 실행할 수 있는 권한
- 소유자 소유 그룹,그 외 사용자로 분류해서 적용
- 사용자의 파일을 보호하는 가장 기본적인 기능
- 파일에 권한이 있어도 상위 디렉토리에 대한 권한이 없으면 파일 변경 불가

### 읽기(r)

- 파일 : 파일의 내용을 읽거나 복사가 가능
- 디렉토리 : ls명령으로 디렉토리의 내용확인 가능 (ls명령의 옵션은 실행권한이 있어야 가능)

### 쓰기(w)

- 파일 : 파일을 수정, 이동, 삭제 가능 (단, 디렉토리에 쓰기 권한 있어야 함)
- 디렉토리 : 파일을 생성하거나 삭제할 수 있다.

### 실행(x)

- 파일 : 파일을 실행할 수 있다.
- 디렉토리 : cd명령 사용 가능. 파일을 디렉토리로 이동하거나 복사할 수 있다.

### 허가권 변경

- 파일이나 디렉토리의 허가권 변경 가능
- 허가권 변경 시 기호나 숫자를 이용하여 변경
- 디렉토리의 경우 R 옵션을 사용하여 안의 파일 및 디렉토리의 허가권을 같이 바꿀 수 있다.

######

    # chmod [소유자 ± 권한],[소유 그룹 ± 권한],[그 외 사용자 ± 권한] [파일 / 디렉토리명]

    사용자 표시
    u : 소유자, g : 소유 그룹, o : 그 외 사용자, a : 모두

    연산자 기호
    + : 권한 부여, - : 권한 제거, = : 권한 설정

    권한 문자
    r : 읽기, w : 쓰기, x : 실행

### 숫자를 이용하여 허가권 변경

- 권한을 한 분류씩 8진수로 표기
- 권한을 2진수로 변경한 후 8진수로 변환
- 각 8진수 한자리가 각 소유권의 허가권이 됨
- 읽기 r = 4, 쓰기 w = 2, 실행 x = 1
- 숫자로 변경할 경우 권한 추가, 제거가 아닌 '='의 의미로 변경됨

######

    # chmod [8진수] [파일 / 디렉토리명]

## 기본 접근 권한 확인 및 변경

- 파일이나 디렉토리가 생성될 때 적용되는 기본 권한
- 디렉토리(777), 파일(666)에서 umask를 뺀 나머지가 기본 권한 설정 값이 됨
- umask 명령어로 확인 가능
- umask XXXX로 변경 가능
- /etc/profile(글로벌) 또는 /etc/bashrc(사용자별)에서 영구적 설정 가능 -> 사용자별이 우선 적용

## 특수권한

### SetUID

    chmod 4755 stest.exe / chmod u+s stest.exe

- SetUID가 설정되면 파일이 실행되는 동안 파일 실행자의 권한이 아닌 파일 소유자의 권한 적용
- 주로 실행 파일에 사용
- 소유자의 실행(x) 부분에 s로 표기됨, 실행 권한이 없는 경우 S
- 접근 권한이 4자리로 되면 맨 앞자리가 4로 됨

### SetGID

    chmod 2755 test / chmod g+s test

- SetGID가 설정되면 파일이 실행되는 동안 파일 실행자의 권한이 아닌 파일 소유 그룹의 권한 적용
- 디렉토리에 설정 시 다른 그룹 사용자가 파일을 생성할 경우 디렉토리에 설정된 그룹의 권한을 가짐
- 주로 디렉토리에 사용
- 소유 그룹의 실행(x) 부분에 s로 표기됨, 실행 권한이 없는 경우 S
- 접근 권한이 4자리로 되며 맨 앞자리가 2로 됨

### StickyBit

    chmod 1755 stest / chmod o+t stest

- 주로 공유 디렉토리에 설정되는 특수 권한
- 디렉토리에 누구나 파일을 생성할 수 있음
- 파일은 생성한 계정으로 소유자가 설정되며, 다른 사용자가 생성한 파일은 삭제가 안 됨
- other의 실행 부분에 t로 표기, 실행 권한이 없는 경우 T
- 접근 권한이 4자리로 되며 맨 앞자리가 1로 됨

## 권한으로 찾기

    # find [경로] -perm [기호] [권한]

    기호없음 : 퍼미션 값과 일치
    - : 퍼미션 값을 포함하는 (이상)
    / : 퍼미션 중 하나 이상 일치하는

    ex) # find / -perm 4000 2> /dev/null
        # find / -perm -4000 2> /dev/null
        # find / -perm /4000 2> /dev/null
